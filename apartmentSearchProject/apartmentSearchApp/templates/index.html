<head>
    <title>COAM</title>

    <!-- Materialize -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <!-- OpenLayers -->
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.1.0/css/ol.css" type="text/css">
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.1.0/build/ol.js"></script>

    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

    <!-- Custom CSS -->
    <style>
        .nav-wrapper {
            background-color: #bb0000;
        }

        #no-price-switch{
            font-size: 13px;
        }
        
        .map {
            height: 150px;
            width: 300px;
        }
    </style>
</head>

<body>
    <nav>
        <div class="nav-wrapper">
            <a href="#" class="brand-logo center">Coordinated Open Apartment Mapper</a>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="col s2">
                <form action="#" id="filter">
                    <div class="row">
                        <div class="input-field col s12">
                            <input id="bedrooms">
                            <label># Bedrooms</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <input id="bathrooms">
                            <label># Bathrooms</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="min-price">
                            <label>Min Price</label>
                        </div>
                        <div class="input-field col s6">
                            <input id="max-price">
                            <label>Max Price</label>
                        </div>
                    </div>
                    <p id="no-price-switch">Show properties without a price</p>
                    <div class="switch">
                        <label>
                            No
                            <input type="checkbox">
                            <span class="lever"></span>
                            Yes
                        </label>
                    </div>
                    <div class="row">
                        <div class="input-field col s6">
                            <input id="min-distance">
                            <label>Min Distance</label>
                        </div>
                        <div class="input-field col s6">
                            <input id="max-distacne">
                            <label>Max Distance</label>
                        </div>
                    </div>
                    <div class="row">
                        <button class="btn waves-effect waves-light col s12" id = "submit" type="submit" name="action">
                            Let's Find an Apartment!
                        </button>
                    </div>
                </form>
            </div>

            <div class="col s10">
                <table class="striped">
                    <thead>
                        <tr>
                            <th>Map</th>
                            <th>Address</th>
                            <th>Price</th>
                            <th>Bedrooms</th>
                            <th>Bathrooms</th>
                        </tr>
                    </thead>

                    {% if listings %}
                    <tbody>
                        {% for listing in listings %}
                        <tr>
                            {% if listing.latitude and listing.longitude %}
                            <td class="map" latitude="{{ listing.latitude }}" longitude="{{ listing.longitude }}"></td>
                            {% else %}
                            <td>N/A</td>
                            {% endif %}
                            <td>{{ listing.address }}</td>
                            <td>${{ listing.price }}</td>
                            <td>{{ listing.num_bedrooms }}</td>
                            <td>{{ listing.num_bathrooms }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    {% else %}
                    <tbody>
                        <tr>
                            <td>No listings</td>
                        </tr>
                    </tbody>
                    {% endif %}
                </table>
            </div>
        </div>
</body>

<script>
    function renderMap(mapElement, latitude, longitude) {
        var map = new ol.Map({
            target: mapElement,
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                })
            ],
            view: new ol.View({
                center: ol.proj.fromLonLat([longitude, latitude]),
                zoom: 15
            })
        });
    }

    $('td.map').each(function () {
        var latitude = $(this).attr('latitude');
        var longitude = $(this).attr('longitude');

        if (latitude && longitude) {
            renderMap(this, latitude, longitude)
        }
    })
</script>

</html>